
@model KonOgren.Domain.Model.Exam
@{ ViewData["Title"] = "Home Page";
    ViewData["page"] = "Index";
    Layout = "~/Views/Shared/_UserLayout.cshtml";

}
 <style>
    .selected {
      background: #FFA500;
    }

    li {
      cursor: pointer;
    }
  </style>
<div class="card" style="margin:10px">

    <div class="card-body p-0" style="margin-inline:50px">
        <div class="row">
            <div class="col-12" style="margin:10px">
                <h1>@Model.Title</h1>


            </div>
            <div class="row">
                <div class="col-12">
                    <p>
                        @Model.Paragraph
                    </p>
                </div>
            </div>
            <table>
                <tr>
                    <td>
                        <p style="font-weight:bold">1)@Model.Questions[0].QuestionTitle</p>
                        <ul id="Q1" qid="@Model.Questions[0].Id">
                            <li opt="1">A) @Model.Questions[0].OptionA</li>
                            <li opt="2">B) @Model.Questions[0].OptionB</li>
                            <li opt="3">C) @Model.Questions[0].OptionC</li>
                            <li opt="4">D) @Model.Questions[0].OptionD</li>
                          </ul>
                    </td>
                    <td>
                        <p style="font-weight:bold">2)@Model.Questions[1].QuestionTitle</p>
                         <ul id="Q2" qid="@Model.Questions[1].Id">
                            <li opt="1">A) @Model.Questions[1].OptionA</li>
                            <li opt="2">B) @Model.Questions[1].OptionB</li>
                            <li opt="3">C) @Model.Questions[1].OptionC</li>
                            <li opt="4">D) @Model.Questions[1].OptionD</li>
                          </ul>
                    </td>
                </tr>
                <tr>
                    <td>
                        <p style="font-weight:bold">3)@Model.Questions[2].QuestionTitle</p>
                       <ul id="Q3" qid="@Model.Questions[2].Id">
                            <li  opt="1">A) @Model.Questions[2].OptionA</li>
                            <li opt="2">B) @Model.Questions[2].OptionB</li>
                            <li opt="3">C) @Model.Questions[2].OptionC</li>
                            <li opt="4">D) @Model.Questions[2].OptionD</li>
                          </ul>
                    </td>
                    <td>
                        <p style="font-weight:bold">4)@Model.Questions[3].QuestionTitle</p>
                        <ul id="Q4" qid="@Model.Questions[3].Id">
                            <li opt="1">A) @Model.Questions[3].OptionA</li>
                            <li opt="2">B) @Model.Questions[3].OptionB</li>
                            <li opt="3">C) @Model.Questions[3].OptionC</li>
                            <li opt="4">D) @Model.Questions[3].OptionD</li>
                          </ul>
                    </td>
                </tr>
            </table>

                <br />
            </div>
            <div align="center">
                    <div  align="center">
                        <button class="btn btn-primary" onclick="finishExam()">Sınavı Tamamla</button>
                    </div>
                    </div>
        </div>
</div>

    <script>
    $(document).ready(function () {
        $('#cmbtitle').on('change', function (e) {
            onTitleSelect(e);
        });
    });
    function onTitleSelect(e) {
        console.log(e.target.value);
        /*$.get(e.target.value, function (data) {
            console.log(data);
        });*/

        $.ajax({
            type: 'GET',
            crossDomain: true,
            url: "@Url.Action("GetUrlContent", "Home")?url=" + e.target.value,
            success: function (jsondata) {
                if (jsondata.success) {
                    $('#txtBody').val(jsondata.data);
                }
                else {
                    //todo error
                }
            }
        })
    }
    function AddExam() {
        var title = $('#cmbtitle option:selected').text();
        if (isNullOrEmpty(title)) {
            //todo message
            return;
        }
        var body = $('#txtBody').val();
        if (isNullOrEmpty(body)) {
            //todo message
            return;
        }
        var Q1A = $('#Q1A').val();
        if (isNullOrEmpty(Q1A)) {
            //todo message
            return;
        }
        var Q1B = $('#Q1B').val();
        if (isNullOrEmpty(Q1B)) {
            //todo message
            return;
        }
        var Q1C = $('#Q1C').val();
        if (isNullOrEmpty(Q1C)) {
            //todo message
            return;
        }
        var Q1D = $('#Q1D').val();
        if (isNullOrEmpty(Q1D)) {
            //todo message
            return;
        }
        var Q1Answer = $('#Q1Answer').val();
        if (isNullOrEmpty(Q1Answer)) {
            //todo message
            return;
        }
        var Q2A = $('#Q2A').val();
        if (isNullOrEmpty(Q2A)) {
            //todo message
            return;
        }
        var Q2B = $('#Q2B').val();
        if (isNullOrEmpty(Q2B )) {
            //todo message
            return;
        }
        var Q2C = $('#Q2C').val();
        if (isNullOrEmpty(Q2C)) {
            //todo message
            return;
        }
        var Q2D = $('#Q2D').val();
        if (isNullOrEmpty(Q2D )) {
            //todo message
            return;
        }
        var Q2Answer = $('#Q2Answer').val();
        if (isNullOrEmpty(Q2Answer)) {
            //todo message
            return;
        }

        var Q3A = $('#Q3A').val();
        if (isNullOrEmpty(Q3A)) {
            //todo message
            return;
        }
        var Q3B = $('#Q3B').val();
        if (isNullOrEmpty(Q3B )) {
            //todo message
            return;
        }
        var Q3C = $('#Q3C').val();
        if (isNullOrEmpty(Q3C )) {
            //todo message
            return;
        }
        var Q3D = $('#Q3D').val();
        if (isNullOrEmpty(Q3D )) {
            //todo message
            return;
        }
        var Q3Answer = $('#Q3Answer').val();
        if (isNullOrEmpty(Q3Answer )) {
            //todo message
            return;
        }

        var Q4A = $('#Q4A').val();
        if (isNullOrEmpty(Q4A)) {
            //todo message
            return;
        }
        var Q4B = $('#Q4B').val();
        if (isNullOrEmpty(Q4B)) {
            //todo message
            return;
        }
        var Q4C = $('#Q4D').val();
        if (isNullOrEmpty(Q4C)) {
            //todo message
            return;
        }
        var Q4D = $('#Q4C').val();
        if (isNullOrEmpty(Q4D )) {
            //todo message
            return;
        }
        var Q4Answer = $('#Q4Answer').val();
        if (isNullOrEmpty( Q4Answer)) {
            //todo message
            return;
        }
        var Q1 = $('#Q1').val();
        if (isNullOrEmpty(Q1)) {
            //todo message
            return;
        }
        var Q4 = $('#Q4').val();
        if (isNullOrEmpty(Q4)) {
            //todo message
            return;
        }
        var Q3 = $('#Q3').val();
        if (isNullOrEmpty(Q3)) {
            //todo message
            return;
        }
        var Q2 = $('#Q2').val();
        if (isNullOrEmpty(Q2)) {
            //todo message
            return;
        }
        var data = {
            "title": title,
            "body": body,
            Q1A: Q1A, Q1B: Q1B, Q1C: Q1C, Q1D: Q1D, Q1Answer: Q1Answer,
            Q2A: Q2A, Q2B: Q2B, Q2C: Q2C, Q2D: Q2D, Q2Answer: Q2Answer,
            Q3A: Q3A, Q3B: Q3B, Q3C: Q3C, Q3D: Q3D, Q3Answer: Q3Answer,
            Q4A: Q4A, Q4B: Q4B, Q4C: Q4C, Q4D: Q4D, Q4Answer: Q4Answer,
            Q1:Q1,Q2:Q2,Q3:Q3,Q4:Q4
        }

        $.ajax({
            type: 'POST',
            url: "@Url.Action("AddExam", "Home")",
            data: data,
            success: function (jsondata) {
                if (jsondata.success) {
                    window.location.href = "@Url.Action("Index","Home")"
                }
                else {
                    //todo error
                }
            }
        });


        /*$.ajax({
            type: "POST",
            url: "@Url.Action("AddExam", "Home")",
            data: {
                "title": body
            },
            success: function (result) {

                var url = window.location.origin
                var fileURL = url + result[0];
                var fileName = result[1];
                download(fileURL, fileName);

            }
        });*/


    }
    function isNullOrEmpty(item) {
        if (item == undefined || item == null || item == "") {
            return true;
        }
        return false;
    }

    var ul = document.getElementsByTagName('ul');
    for(var i=0;i<ul.length;i++)
    {
        ul[i].onclick = function(event) {
              if (event.target.tagName != "LI") return;

              if (event.ctrlKey || event.metaKey) {
                toggleSelect(event.target);
              } else {
                singleSelect(event.target,ul[i]);
              }

        }
        ul[i].onmousedown = function() {
            return false;
        };
    }
    function toggleSelect(li) {
      li.classList.toggle('selected');
    }

    function singleSelect(li) {
        
      let selected = li.parentNode.querySelectorAll('.selected');
      for(let elem of selected) {
        elem.classList.remove('selected');
      }
      li.classList.add('selected');
    }

    function finishExam(){
        var examId= '@Model.Id'
        var q1 = $('#Q1 li.selected').attr("opt");
        var q1Id = $('#Q1').attr("qid");
        var q2 = $('#Q2 li.selected').attr("opt");
        var q2Id = $('#Q2').attr("qid");
        var q3 = $('#Q3 li.selected').attr("opt");
        var q3Id = $('#Q3').attr("qid");
        var q4 = $('#Q4 li.selected').attr("opt");
        var q4Id = $('#Q4').attr("qid");
        var data = {id:examId, q1:q1,q2:q2,q3:q3,q4:q4,q1Id:q1Id,q2Id:q2Id,q3Id:q3Id,q4Id:q4Id}

         $.ajax({
            type: 'POST',
            url: "@Url.Action("CheckResult", "Home")",
            data: data,
            success: function (jsondata) {
                if (jsondata.success) {
                    if(q1 == jsondata.data.q1)
                    {
                         $('#Q1 li.selected').css("background","#44ff33")
                    }
                    else{
                         $('#Q1 li.selected').css("background","#ff3333")
                        $('#Q1 li[opt="'+jsondata.data.q1+'"]').css("background","#88cc33")
                    }

                     if(q2 == jsondata.data.q2)
                    {
                         $('#Q2 li.selected').css("background","#44ff33")
                    }
                    else{
                         $('#Q2 li.selected').css("background","#ff3333")
                        $('#Q2 li[opt="'+jsondata.data.q2+'"]').css("background","#88cc33")
                    }

                     if(q3 == jsondata.data.q3)
                    {
                         $('#Q3 li.selected').css("background","#44ff33")
                    }
                    else{
                         $('#Q3 li.selected').css("background","#ff3333")
                        $('#Q3 li[opt="'+jsondata.data.q3+'"]').css("background","#88cc33")
                    }

                    if(q4 == jsondata.data.q4)
                    {
                         $('#Q4 li.selected').css("background","#44ff33")
                    }
                    else{
                        $('#Q4 li.selected').css("background","#ff3333")
                        $('#Q4 li[opt="'+jsondata.data.q4+'"]').css("background","#88cc33")
                    }
                }
                else {
                    //todo error
                }
            }
        });
    }
    </script>


